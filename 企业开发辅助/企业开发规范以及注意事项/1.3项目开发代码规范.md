# 格式化

代码写完随时格式化！保证代码质量以及代码格式，控制缩进以及结构。

# **日志规范**

业务代码需有可用的日志输出。日志也是代码的一部分，提交代码前先运行看一遍操作日志。

- 查询数据库的操作前后需打印对应的查询参数与查询结果。(如果结果有可能为超长数据，需处理为仅打印 list 长度)

- 无效的或者大量的数据日志例如富文本，省市县列表，需特殊处理，避免无效日志。如果对排查问题有帮助需要打印，可单独拆出额外的日志文件打印。

- 分支语句的变量需要打印变量。

- 大量数据操作的时候需要打印数据长度。

- 异常信息里面，不正确的参数值要提示出来，减少定位时间。

分支语句变量会影响代码走向，不打日志无法知道究竟走哪个个分支。如下

```Bash
// optype决定代码走向，需要打印日志
logger.info("edit user, opType:"+ opType);
if(opType == CREATE) {// 新增操作} 
else if(opType == UPDATE) {// 修改操作} 
else {// 错误的类型，抛出异常 throw new IllegalArgumentException("unknown optype:"+ opType);}
```

如果没有打印optype的值，出了问题你只能从前找到后，看optype是什么了，很浪费时间。

> 重要建议：养成增加else语句，把不合法参数抛出异常的好习惯。

**大量数据操作的时候需要打印数据长度**

建议前后打印日志，而且要打印出数据长度，目的是为了知道 `处理了多少数据用了多少时间` 。如一个操作用了3秒钟，性能是好还是坏？ 如果处理了1条数据，那么可能就是性能差，如果处理了10000条数据，那么可能就是性能好。

```Bash
logger.info("query docment start, params:"+ params);
List<Document> docList = query(params);
logger.info("query docment done, size:"+ docList.size())
```

# **Controller 接口定义:**

- 所有业务接口都必须返回 Result。(文件下载之类的除外)

- 一开始就要考虑成功和失败两种场景。

- Result 只允许出现在 controller，不允许到处传。

- 不要出现 map ，json 等复杂对象做为输入和输出。

- 不要出现 local ，messagesource 等和业务无关的参数。

- 分页查询可继承 PageReq 或 BasePage。

- 分列列表返回分页信息统一使用 PageUtils。

# **异常处理**

- 不允许出现异常吞掉并且无任何输出留痕的情况。

- 抛异常的时候需把对应的非法值抛出来。最优解为根据报警信息可还原事发现场。

# **枚举类命名及使用规范**

- 枚举名 为字段名转驼峰 后加 Enum
  - 例如订单支付状态 pay_status 对应的枚举名为 PayStatusEnum

- 如果状态字段不能表示业务需加上表名, 例如 订单表 order 状态 status 对应的枚举名为 OrderStatusEnum

- 如有用到同一枚举类中多个状态的逻辑判断，约定将状态判断写在该状态的枚举中。

# **和三方对接**

- 和三方的接口交互需记录出参入参，尽量和三方接口解耦

- 如果三方服务不可用，需有降级机制，不可以直接服务不可用，可与产品沟通此种情况下的处理逻辑，如何给用户友好提示

- 建议有对应的 mock 机制，包括回调数据，可自己回调通知自己来继续流程

# **接口文档:**

- 任何人对着需求界面 ，看文档就知道对应的接口是哪个。

- 固定字符串类型参数 ，看文档就知道参数有哪些值。

# **数据库注意事项：**

- 任何公共环境的数据库禁止直接删库。

- 如果有必要重置数据库， 需在删除表之前和开发、测试及产品确认是否影响使用，并使用 alter 语句将原表备份。不可直接删除。

# **代码规范：**

- 不要使用 import * 

- 废弃的方法或对象及时删除

- 数据库操作的 Mapper 路径约定为 com.botpy.vosp.*.business.*.repository

# **其他**

- 推荐复用代码，尽量不要复制粘贴 

- 不要替别人提交代码，不论原作者是谁，出现问题将根据提交记录确认责任人